<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تبدیل تصویر به ایموجی</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
            background-color: black;
            color: white;
        }
        .emoji-image {
            font-size: 10px; /* افزایش سایز ایموجی‌ها برای نمایش جزئیات بیشتر */
            white-space: pre;
            line-height: 10px;
            background-color: black;
            display: inline-block;
            text-align: left;
        }
    </style>
</head>
<body>
    <h1>تبدیل تصویر به ایموجی</h1>
    <input type="file" id="imageInput" accept="image/*">
    <button onclick="convertToEmoji()">تبدیل به ایموجی</button>
    <button id="downloadBtn" style="display: none;" onclick="downloadEmojiImage()">دانلود</button>
    <pre id="emojiOutput" class="emoji-image"></pre>

    <script>
        function convertToEmoji() {
            const input = document.getElementById('imageInput');
            if (!input.files.length) {
                alert('لطفاً یک تصویر انتخاب کنید.');
                return;
            }

            const file = input.files[0];
            const reader = new FileReader();

            reader.onload = function (event) {
                const img = new Image();
                img.src = event.target.result;

                img.onload = function () {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');

                    // افزایش جزئیات تصویر (۱۰ برابر بیشتر)
                    const maxSize = 100; // حداکثر عرض یا ارتفاع کانواس
                    const scale = Math.max(img.width, img.height) / maxSize;
                    canvas.width = Math.floor(img.width / scale);
                    canvas.height = Math.floor(img.height / scale);

                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const data = imageData.data;

                    let emojiOutput = '';
                    for (let y = 0; y < canvas.height; y++) {
                        for (let x = 0; x < canvas.width; x++) {
                            const i = (y * canvas.width + x) * 4;
                            const r = data[i];
                            const g = data[i + 1];
                            const b = data[i + 2];

                            emojiOutput += getEmojiByColor(r, g, b);
                        }
                        emojiOutput += '\n';
                    }

                    document.getElementById('emojiOutput').textContent = emojiOutput;
                    document.getElementById('downloadBtn').style.display = 'inline-block';
                };
            };

            reader.readAsDataURL(file);
        }

        function getEmojiByColor(r, g, b) {
            const brightness = (r * 0.299 + g * 0.587 + b * 0.114) / 255;
            let hue = Math.atan2(Math.sqrt(3) * (g - b), 2 * r - g - b) * (180 / Math.PI);
            if (hue < 0) hue += 360;

            // لیست ایموجی‌های بیشتر برای دقت رنگی بالاتر
            const emojis = [
                '⬛', '⬜', '🔴', '🟠', '🟡', '🟢', '🔵', '🟣', '🟤', '⚫', '⚪', '🔺', '🔻', '🔶', '🔷', '🔳',
                '🟥', '🟧', '🟨', '🟩', '🟦', '🟪', '🟫', '🏴', '🏳️', '🔘', '🟰', '🎨', '🎭', '🎲', '🎵', '🎶', '🎼',
                '🎧', '🎤', '🎷', '🎺', '🎸', '🎻', '🎮', '🎰', '🎯', '🎳', '⚽', '🏀', '🏈', '⚾', '🥎', '🏐',
                '🏉', '🎱', '🎾', '🥏', '🎿', '🏂', '⛷️', '🏋️', '🏊', '🚴', '🚵', '🥇', '🥈', '🥉', '🏆', '🏅',
                '🎖️', '🥊', '🥋', '⛸️', '🎽', '⛳', '🎯', '🥌', '🏹', '🎣', '🌍', '🌎', '🌏', '🪐', '💫', '⭐',
                '🌟', '✨', '🔥', '💧', '🌊', '🌀', '☁️', '⛈️', '🌩️', '🌪️', '🌈', '❄️', '☃️', '⛸️', '☀️', '🌤️',
                '🌥️', '🌦️', '🌧️', '🌨️', '🌫️', '🌬️', '🌵', '🎋', '🍀', '🍁', '🌳', '🌴', '🌱', '🌿', '🍃', '🍂',
                '☘️', '🌺', '🌻', '🌹', '🥀', '🌾', '🌼', '🌷', '💐', '🍄', '🎄', '🎋', '🌵', '🎍', '🍎', '🍌',
                '🍉', '🍇', '🍓', '🥭', '🍑', '🍒', '🍊', '🍍', '🥥', '🥝', '🍈', '🍏', '🥕', '🌽', '🥒', '🥬',
                '🥦', '🧄', '🧅', '🥔', '🍠', '🥜', '🌰', '🍞', '🥖', '🥯', '🥞', '🥓', '🥩', '🍗', '🍖', '🍔',
                '🍟', '🍕', '🌭', '🍿', '🥤', '🍩', '🍪', '🍰', '🎂', '🧁', '🍫', '🍬', '🍭', '🍮', '🍯',
                '🍷', '🍸', '🍺', '🍻', '🥂', '🥃', '🍾', '🍶', '🍷', '🥧', '🍖', '🥨', '🍲', '🍳', '🍿', '🍺',
                '🍴', '🥄', '🍽️', '🍗', '🥩', '🍖', '🍤', '🍠', '🍏', '🍋', '🍒', '🍉', '🍌', '🍓', '🥭', '🥥', '🥝',
                // لیست ایموجی‌های بیشتر
            ];

            // تبدیل hue و brightness به مقدار عددی ۰ تا ۴۰۹۶
            const hueIndex = Math.floor((hue / 360) * 64);
            const brightnessIndex = Math.floor(brightness * 64);  // افزایش دقت رنگی
            const index = (hueIndex * 64 + brightnessIndex) % emojis.length;

            return emojis[index];
        }

        function downloadEmojiImage() {
            const outputDiv = document.getElementById('emojiOutput');
            const blob = new Blob([outputDiv.textContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'emoji_image.txt';
            a.click();
        }
    </script>
</body>
</html>
