<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تبدیل تصویر به ایموجی</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        .emoji-image {
            font-size: 10px;
            white-space: pre;
            line-height: 10px;
        }
    </style>
</head>
<body>
    <h1>تبدیل تصویر به ایموجی</h1>
    <input type="file" id="imageInput" accept="image/*">
    <button onclick="convertToEmoji()">تبدیل به ایموجی</button>
    <button id="downloadBtn" style="display: none;" onclick="downloadEmojiImage()">دانلود</button>
    <pre id="emojiOutput" class="emoji-image"></pre>

    <script>
        function convertToEmoji() {
            const input = document.getElementById('imageInput');
            if (!input.files.length) {
                alert('لطفاً یک تصویر انتخاب کنید.');
                return;
            }

            const file = input.files[0];
            const reader = new FileReader();

            reader.onload = function (event) {
                const img = new Image();
                img.src = event.target.result;

                img.onload = function () {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');

                    // تنظیم اندازه کوچک‌تر برای پردازش سریع‌تر
                    const scale = Math.max(img.width, img.height) / 50;
                    canvas.width = img.width / scale;
                    canvas.height = img.height / scale;

                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const data = imageData.data;

                    let emojiOutput = '';
                    for (let y = 0; y < canvas.height; y++) {
                        for (let x = 0; x < canvas.width; x++) {
                            const i = (y * canvas.width + x) * 4;
                            const r = data[i];
                            const g = data[i + 1];
                            const b = data[i + 2];

                            // گرفتن ایموجی متناظر با رنگ
                            emojiOutput += getEmojiByColor(r, g, b);
                        }
                        emojiOutput += '\n';
                    }

                    document.getElementById('emojiOutput').textContent = emojiOutput;
                    document.getElementById('downloadBtn').style.display = 'inline-block';
                };
            };

            reader.readAsDataURL(file);
        }

        function getEmojiByColor(r, g, b) {
            // تبدیل RGB به مقیاس خاکستری برای بررسی روشنی
            const brightness = (r * 0.299 + g * 0.587 + b * 0.114) / 255;

            // تبدیل RGB به Hue برای تشخیص رنگ اصلی
            let max = Math.max(r, g, b);
            let min = Math.min(r, g, b);
            let delta = max - min;
            let hue = 0;

            if (delta !== 0) {
                if (max === r) {
                    hue = ((g - b) / delta) % 6;
                } else if (max === g) {
                    hue = (b - r) / delta + 2;
                } else {
                    hue = (r - g) / delta + 4;
                }
                hue = Math.round(hue * 60);
                if (hue < 0) hue += 360;
            }

            // تخصیص ایموجی‌ها بر اساس Hue و Brightness
            if (brightness > 0.9) return '⬜'; // سفید
            if (brightness < 0.1) return '⬛'; // سیاه

            if (hue < 15 || hue > 345) return '❤️'; // قرمز
            if (hue < 45) return '🟠'; // نارنجی
            if (hue < 75) return '💛'; // زرد
            if (hue < 105) return '💚'; // سبز روشن
            if (hue < 135) return '🌿'; // سبز گیاهی
            if (hue < 165) return '💙'; // آبی
            if (hue < 195) return '🦋'; // آبی تیره
            if (hue < 225) return '🔵'; // آبی پررنگ
            if (hue < 255) return '💜'; // بنفش
            if (hue < 285) return '🟣'; // بنفش تیره
            if (hue < 315) return '🌸'; // صورتی
            if (hue < 345) return '🎀'; // صورتی پررنگ

            return '⬛'; // پیش‌فرض: سیاه
        }

        function downloadEmojiImage() {
            const outputDiv = document.getElementById('emojiOutput');
            const blob = new Blob([outputDiv.textContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'emoji_image.txt';
            a.click();
        }
    </script>
</body>
</html>
