<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تشخیص و حذف اشیا از عکس</title>
    <script async src="https://docs.opencv.org/4.x/opencv.js"></script>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        canvas { border: 1px solid black; }
        #container { position: relative; display: inline-block; }
        .box { position: absolute; border: 2px solid red; cursor: pointer; }
    </style>
</head>
<body>

    <h2>آپلود عکس و حذف اشیا</h2>
    <input type="file" id="upload" accept="image/*">
    <div id="container">
        <canvas id="canvas"></canvas>
    </div>

    <script>
        document.getElementById("upload").addEventListener("change", function (event) {
            let file = event.target.files[0];
            if (!file) return;

            let img = new Image();
            img.src = URL.createObjectURL(file);
            img.onload = function () {
                let canvas = document.getElementById("canvas");
                let ctx = canvas.getContext("2d");
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);

                // وقتی OpenCV آماده شد، اشیا را شناسایی کن
                cv["onRuntimeInitialized"] = function () {
                    detectObjects(img, canvas);
                };
            };
        });

        function detectObjects(img, canvas) {
            let src = cv.imread(canvas);
            let gray = new cv.Mat();
            cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY);

            let edges = new cv.Mat();
            cv.Canny(gray, edges, 50, 150);

            let contours = new cv.MatVector();
            let hierarchy = new cv.Mat();
            cv.findContours(edges, contours, hierarchy, cv.RETR_EXTERNAL, cv.CHAIN_APPROX_SIMPLE);

            let ctx = canvas.getContext("2d");
            let container = document.getElementById("container");

            for (let i = 0; i < contours.size(); i++) {
                let rect = cv.boundingRect(contours.get(i));

                let box = document.createElement("div");
                box.classList.add("box");
                box.style.left = rect.x + "px";
                box.style.top = rect.y + "px";
                box.style.width = rect.width + "px";
                box.style.height = rect.height + "px";
                box.onclick = function () { removeObject(rect, canvas); };

                container.appendChild(box);
            }

            src.delete(); gray.delete(); edges.delete();
            contours.delete(); hierarchy.delete();
        }

        function removeObject(rect, canvas) {
            let ctx = canvas.getContext("2d");
            ctx.clearRect(rect.x, rect.y, rect.width, rect.height);
        }
    </script>

</body>
</html>
